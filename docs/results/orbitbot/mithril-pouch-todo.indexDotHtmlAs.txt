b'<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml">\n <head>\n  <meta charset="utf-8"/>\n  <title>\n   mithril-pouch-todo\n  </title>\n  <link href="css/fontello.css" rel="stylesheet"/>\n  <link href="css/style.css" rel="stylesheet"/>\n  <script>\n   var todo = {};\n\nvar Todo = function(data) {\n  this.description = m.prop(data.description);\n  this.done = data.done ? m.prop(data.done) : m.prop(false);\n};\n\nvar Pouch = function() {\n  this.db = new PouchDB({ name: \'mithril-todo\', auto_compaction: true });\n\n  this.load = function() {\n    return this.db.get(\'todos\')\n      .then(function(retrieved) {\n        if (retrieved)\n          return JSON.parse(retrieved.todos).map(function(parsed) { return new Todo(parsed); });\n        else\n          return [];\n      })\n      .catch(function(error) {\n        console.error(\'error loading!\', error);\n        return [];\n      });\n  };\n\n  this.store = function(todos) {\n    this.db.upsert(\'todos\', function() {\n      return { todos: JSON.stringify(todos) };\n    }).catch(function(error) {\n      console.error(\'store failed!\', error);\n    });\n  };\n};\n\nvar TodoList = function() {\n  var db = new Pouch();\n  var todos = m.prop(db.load());\n  todos.then(todos);\n\n  this.push = function(todo) {\n    todos().push(todo);\n    db.store(todos());\n  };\n\n  this.splice = function(todo) {\n    var dos = todos();\n    dos.splice(dos.indexOf(todo), 1);\n    db.store(todos());\n  };\n\n  this.update = function(todo) {\n    var dos = todos();\n    dos[dos.indexOf(todo)] = todo;\n    todos(dos);\n    db.store(todos);\n  };\n\n  this.map = function(func) {\n    var dos = todos();\n    if (dos)\n      return dos.map(func);\n    else\n      todos.then(m.redraw);\n  };\n};\n\ntodo.vm = {\n  init: function() {\n          todo.vm.list = new TodoList();\n\n          todo.vm.description = m.prop(\'\');\n\n          function addTodo() {\n            if (todo.vm.description()) {\n              todo.vm.list.push(new Todo({ description: todo.vm.description() }));\n              todo.vm.description(\'\');\n            }\n          }\n\n          todo.vm.keyup = function(e) {\n            todo.vm.description(e.target.value);\n            e.preventDefault();\n            if (e.which === 13)\n              addTodo();\n          };\n\n          todo.vm.toggle = function() {\n            this.done(!this.done());\n            todo.vm.list.update(this);\n          };\n\n          todo.vm.remove = function() {\n            todo.vm.list.splice(this);\n          };\n        }\n};\n\ntodo.controller = function() {\n  todo.vm.init();\n};\n\ntodo.view = function() {\n  return {tag: "div", attrs: {}, children: [\n            \n              todo.vm.list.map(function(task, index) {\n                return {tag: "div", attrs: {class:"task"}, children: [\n                          {tag: "i", attrs: {class: task.done() ? "icon-cancel-done" : "icon-angle-right"\xc2\xa0}}, \n                          {tag: "span", attrs: {class:"align-text", \n                            style: task.done() ? "color: grey;" : "color: inherit;"}, children: [\n                             task.description() \n                          ]}, \n                          {tag: "i", attrs: {class:"icon-emo-thumbsup", \n                            onclick: todo.vm.toggle.bind(task) }\n                          }, \n                          {tag: "i", attrs: {class:"icon-cancel", \n                            onclick: todo.vm.remove.bind(task) }\n                          }\n                       ]}\n              }), \n            \n            {tag: "input", attrs: {type:"text", autofocus:true,placeholder:"What do you need done?", \n              value: todo.vm.description(), \n              onkeyup: todo.vm.keyup}\n            }\n      ]}\n};\n\nm.mount(document.getElementById(\'todoApp\'), todo);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbIm1pdGhyaWwtcG91Y2gtdG9kby9taXRocmlsLXBvdWNoLXRvZG8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDOztBQUVkLElBQUksSUFBSSxHQUFHLFNBQVMsSUFBSSxFQUFFO0VBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7RUFDNUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUQsQ0FBQyxDQUFDOztBQUVGLElBQUksS0FBSyxHQUFHLFdBQVc7QUFDdkIsRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQzs7RUFFdkUsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXO0lBQ3JCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO09BQ3hCLElBQUksQ0FBQyxTQUFTLFNBQVMsRUFBRTtRQUN4QixJQUFJLFNBQVM7QUFDckIsVUFBVSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLE1BQU0sRUFBRSxFQUFFLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7O1VBRXRGLE9BQU8sRUFBRSxDQUFDO09BQ2IsQ0FBQztPQUNELEtBQUssQ0FBQyxTQUFTLEtBQUssRUFBRTtRQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FB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QUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHRvZG8gPSB7fTtcblxudmFyIFRvZG8gPSBmdW5jdGlvbihkYXRhKSB7XG4gIHRoaXMuZGVzY3JpcHRpb24gPSBtLnByb3AoZGF0YS5kZXNjcmlwdGlvbik7XG4gIHRoaXMuZG9uZSA9IGRhdGEuZG9uZSA/IG0ucHJvcChkYXRhLmRvbmUpIDogbS5wcm9wKGZhbHNlKTtcbn07XG5cbnZhciBQb3VjaCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRiID0gbmV3IFBvdWNoREIoeyBuYW1lOiAnbWl0aHJpbC10b2RvJywgYXV0b19jb21wYWN0aW9uOiB0cnVlIH0pO1xuXG4gIHRoaXMubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmRiLmdldCgndG9kb3MnKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmV0cmlldmVkKSB7XG4gICAgICAgIGlmIChyZXRyaWV2ZWQpXG4gICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmV0cmlldmVkLnRvZG9zKS5tYXAoZnVuY3Rpb24ocGFyc2VkKSB7IHJldHVybiBuZXcgVG9kbyhwYXJzZWQpOyB9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignZXJyb3IgbG9hZGluZyEnLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0pO1xuICB9O1xuXG4gIHRoaXMuc3RvcmUgPSBmdW5jdGlvbih0b2Rvcykge1xuICAgIHRoaXMuZGIudXBzZXJ0KCd0b2RvcycsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHsgdG9kb3M6IEpTT04uc3RyaW5naWZ5KHRvZG9zKSB9O1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdzdG9yZSBmYWlsZWQhJywgZXJyb3IpO1xuICAgIH0pO1xuICB9O1xufTtcblxudmFyIFRvZG9MaXN0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBkYiA9IG5ldyBQb3VjaCgpO1xuICB2YXIgdG9kb3MgPSBtLnByb3AoZGIubG9hZCgpKTtcbiAgdG9kb3MudGhlbih0b2Rvcyk7XG5cbiAgdGhpcy5wdXNoID0gZnVuY3Rpb24odG9kbykge1xuICAgIHRvZG9zKCkucHVzaCh0b2RvKTtcbiAgICBkYi5zdG9yZSh0b2RvcygpKTtcbiAgfTtcblxuICB0aGlzLnNwbGljZSA9IGZ1bmN0aW9uKHRvZG8pIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBkb3Muc3BsaWNlKGRvcy5pbmRleE9mKHRvZG8pLCAxKTtcbiAgICBkYi5zdG9yZSh0b2RvcygpKTtcbiAgfTtcblxuICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKHRvZG8pIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBkb3NbZG9zLmluZGV4T2YodG9kbyldID0gdG9kbztcbiAgICB0b2Rvcyhkb3MpO1xuICAgIGRiLnN0b3JlKHRvZG9zKTtcbiAgfTtcblxuICB0aGlzLm1hcCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBpZiAoZG9zKVxuICAgICAgcmV0dXJuIGRvcy5tYXAoZnVuYyk7XG4gICAgZWxzZVxuICAgICAgdG9kb3MudGhlbihtLnJlZHJhdyk7XG4gIH07XG59O1xuXG50b2RvLnZtID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0b2RvLnZtLmxpc3QgPSBuZXcgVG9kb0xpc3QoKTtcblxuICAgICAgICAgIHRvZG8udm0uZGVzY3JpcHRpb24gPSBtLnByb3AoJycpO1xuXG4gICAgICAgICAgZnVuY3Rpb24gYWRkVG9kbygpIHtcbiAgICAgICAgICAgIGlmICh0b2RvLnZtLmRlc2NyaXB0aW9uKCkpIHtcbiAgICAgICAgICAgICAgdG9kby52bS5saXN0LnB1c2gobmV3IFRvZG8oeyBkZXNjcmlwdGlvbjogdG9kby52bS5kZXNjcmlwdGlvbigpIH0pKTtcbiAgICAgICAgICAgICAgdG9kby52bS5kZXNjcmlwdGlvbignJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdG9kby52bS5rZXl1cCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRvZG8udm0uZGVzY3JpcHRpb24oZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDEzKVxuICAgICAgICAgICAgICBhZGRUb2RvKCk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRvZG8udm0udG9nZ2xlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmRvbmUoIXRoaXMuZG9uZSgpKTtcbiAgICAgICAgICAgIHRvZG8udm0ubGlzdC51cGRhdGUodGhpcyk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRvZG8udm0ucmVtb3ZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0b2RvLnZtLmxpc3Quc3BsaWNlKHRoaXMpO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbn07XG5cbnRvZG8uY29udHJvbGxlciA9IGZ1bmN0aW9uKCkge1xuICB0b2RvLnZtLmluaXQoKTtcbn07XG5cbnRvZG8udmlldyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdG9kby52bS5saXN0Lm1hcChmdW5jdGlvbih0YXNrLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzPVwidGFza1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz17IHRhc2suZG9uZSgpID8gXCJpY29uLWNhbmNlbC1kb25lXCIgOiBcImljb24tYW5nbGUtcmlnaHRcIsKgfT48L2k+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiYWxpZ24tdGV4dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9eyB0YXNrLmRvbmUoKSA/IFwiY29sb3I6IGdyZXk7XCIgOiBcImNvbG9yOiBpbmhlcml0O1wiIH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0YXNrLmRlc2NyaXB0aW9uKCkgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiaWNvbi1lbW8tdGh1bWJzdXBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s9eyB0b2RvLnZtLnRvZ2dsZS5iaW5kKHRhc2spIH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvaT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJpY29uLWNhbmNlbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljaz17IHRvZG8udm0ucmVtb3ZlLmJpbmQodGFzaykgfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9pPlxuICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGF1dG9mb2N1cyBwbGFjZWhvbGRlcj1cIldoYXQgZG8geW91IG5lZWQgZG9uZT9cIlxuICAgICAgICAgICAgICB2YWx1ZT17IHRvZG8udm0uZGVzY3JpcHRpb24oKSB9XG4gICAgICAgICAgICAgIG9ua2V5dXA9eyB0b2RvLnZtLmtleXVwIH1cbiAgICAgICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbn07XG5cbm0ubW91bnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG9BcHAnKSwgdG9kbyk7Il19\n  </script>\n </head>\n <body>\n  <div class="header">\n   <h1>\n    Todos\n    <i class="icon-emo-thumbsup">\n    </i>\n   </h1>\n  </div>\n  <div id="todoApp">\n  </div>\n  <div class="footer">\n   <a href="https://github.com/orbitbot/mithril-pouch-todo">\n    find me on github\n   </a>\n  </div>\n  <script async="" src="http://www.google-analytics.com/ga.js" type="text/javascript">\n  </script>\n  <script src="libs/mithril.js">\n  </script>\n  <script src="libs/MSXTransformer.js">\n  </script>\n  <script src="libs/pouchdb.min.js">\n  </script>\n  <script src="libs/pouchdb.upsert.min.js">\n  </script>\n  <script src="mithril-pouch-todo.js" type="text/msx">\n  </script>\n  <!-- Google Analytics -->\n  <script>\n   var _gaq = _gaq || [];\n        _gaq.push([\'_setAccount\', \'UA-58175967-4\']);\n        _gaq.push([\'_trackPageview\']);\n        (function() {\n          var ga = document.createElement(\'script\'); ga.type = \'text/javascript\'; ga.async = true;\n          ga.src = (\'https:\' == document.location.protocol ? \'https://ssl\' : \'http://www\') + \'.google-analytics.com/ga.js\';\n          var s = document.getElementsByTagName(\'script\')[0]; s.parentNode.insertBefore(ga, s);\n        })();\n  </script>\n </body>\n</html>'b'<!DOCTYPE html>\n<html xmlns="http://www.w3.org/1999/xhtml">\n <head>\n  <meta charset="utf-8"/>\n  <title>\n   mithril-pouch-todo\n  </title>\n  <link href="css/fontello.css" rel="stylesheet"/>\n  <link href="css/style.css" rel="stylesheet"/>\n  <script>\n   var todo = {};\n\nvar Todo = function(data) {\n  this.description = m.prop(data.description);\n  this.done = data.done ? m.prop(data.done) : m.prop(false);\n};\n\nvar Pouch = function() {\n  this.db = new PouchDB({ name: \'mithril-todo\', auto_compaction: true });\n\n  this.load = function() {\n    return this.db.get(\'todos\')\n      .then(function(retrieved) {\n        if (retrieved)\n          return JSON.parse(retrieved.todos).map(function(parsed) { return new Todo(parsed); });\n        else\n          return [];\n      })\n      .catch(function(error) {\n        console.error(\'error loading!\', error);\n        return [];\n      });\n  };\n\n  this.store = function(todos) {\n    this.db.upsert(\'todos\', function() {\n      return { todos: JSON.stringify(todos) };\n    }).catch(function(error) {\n      console.error(\'store failed!\', error);\n    });\n  };\n};\n\nvar TodoList = function() {\n  var db = new Pouch();\n  var todos = m.prop(db.load());\n  todos.then(todos);\n\n  this.push = function(todo) {\n    todos().push(todo);\n    db.store(todos());\n  };\n\n  this.splice = function(todo) {\n    var dos = todos();\n    dos.splice(dos.indexOf(todo), 1);\n    db.store(todos());\n  };\n\n  this.update = function(todo) {\n    var dos = todos();\n    dos[dos.indexOf(todo)] = todo;\n    todos(dos);\n    db.store(todos);\n  };\n\n  this.map = function(func) {\n    var dos = todos();\n    if (dos)\n      return dos.map(func);\n    else\n      todos.then(m.redraw);\n  };\n};\n\ntodo.vm = {\n  init: function() {\n          todo.vm.list = new TodoList();\n\n          todo.vm.description = m.prop(\'\');\n\n          function addTodo() {\n            if (todo.vm.description()) {\n              todo.vm.list.push(new Todo({ description: todo.vm.description() }));\n              todo.vm.description(\'\');\n            }\n          }\n\n          todo.vm.keyup = function(e) {\n            todo.vm.description(e.target.value);\n            e.preventDefault();\n            if (e.which === 13)\n              addTodo();\n          };\n\n          todo.vm.toggle = function() {\n            this.done(!this.done());\n            todo.vm.list.update(this);\n          };\n\n          todo.vm.remove = function() {\n            todo.vm.list.splice(this);\n          };\n        }\n};\n\ntodo.controller = function() {\n  todo.vm.init();\n};\n\ntodo.view = function() {\n  return {tag: "div", attrs: {}, children: [\n            \n              todo.vm.list.map(function(task, index) {\n                return {tag: "div", attrs: {class:"task"}, children: [\n                          {tag: "i", attrs: {class: task.done() ? "icon-cancel-done" : "icon-angle-right"\xc2\xa0}}, \n                          {tag: "span", attrs: {class:"align-text", \n                            style: task.done() ? "color: grey;" : "color: inherit;"}, children: [\n                             task.description() \n                          ]}, \n                          {tag: "i", attrs: {class:"icon-emo-thumbsup", \n                            onclick: todo.vm.toggle.bind(task) }\n                          }, \n                          {tag: "i", attrs: {class:"icon-cancel", \n                            onclick: todo.vm.remove.bind(task) }\n                          }\n                       ]}\n              }), \n            \n            {tag: "input", attrs: {type:"text", autofocus:true,placeholder:"What do you need done?", \n              value: todo.vm.description(), \n              onkeyup: todo.vm.keyup}\n            }\n      ]}\n};\n\nm.mount(document.getElementById(\'todoApp\'), todo);\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhbnNmb3JtZWQuanMiLCJzb3VyY2VzIjpbIm1pdGhyaWwtcG91Y2gtdG9kby9taXRocmlsLXBvdWNoLXRvZG8uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDOztBQUVkLElBQUksSUFBSSxHQUFHLFNBQVMsSUFBSSxFQUFFO0VBQ3hCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7RUFDNUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUQsQ0FBQyxDQUFDOztBQUVGLElBQUksS0FBSyxHQUFHLFdBQVc7QUFDdkIsRUFBRSxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQzs7RUFFdkUsSUFBSSxDQUFDLElBQUksR0FBRyxXQUFXO0lBQ3JCLE9BQU8sSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO09BQ3hCLElBQUksQ0FBQyxTQUFTLFNBQVMsRUFBRTtRQUN4QixJQUFJLFNBQVM7QUFDckIsVUFBVSxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLE1BQU0sRUFBRSxFQUFFLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7O1VBRXRGLE9BQU8sRUFBRSxDQUFDO09BQ2IsQ0FBQztPQUNELEtBQUssQ0FBQyxTQUFTLEtBQUssRUFBRTtRQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLEtBQUssQ0FB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QUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHRvZG8gPSB7fTtcblxudmFyIFRvZG8gPSBmdW5jdGlvbihkYXRhKSB7XG4gIHRoaXMuZGVzY3JpcHRpb24gPSBtLnByb3AoZGF0YS5kZXNjcmlwdGlvbik7XG4gIHRoaXMuZG9uZSA9IGRhdGEuZG9uZSA/IG0ucHJvcChkYXRhLmRvbmUpIDogbS5wcm9wKGZhbHNlKTtcbn07XG5cbnZhciBQb3VjaCA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmRiID0gbmV3IFBvdWNoREIoeyBuYW1lOiAnbWl0aHJpbC10b2RvJywgYXV0b19jb21wYWN0aW9uOiB0cnVlIH0pO1xuXG4gIHRoaXMubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmRiLmdldCgndG9kb3MnKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmV0cmlldmVkKSB7XG4gICAgICAgIGlmIChyZXRyaWV2ZWQpXG4gICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmV0cmlldmVkLnRvZG9zKS5tYXAoZnVuY3Rpb24ocGFyc2VkKSB7IHJldHVybiBuZXcgVG9kbyhwYXJzZWQpOyB9KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignZXJyb3IgbG9hZGluZyEnLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH0pO1xuICB9O1xuXG4gIHRoaXMuc3RvcmUgPSBmdW5jdGlvbih0b2Rvcykge1xuICAgIHRoaXMuZGIudXBzZXJ0KCd0b2RvcycsIGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHsgdG9kb3M6IEpTT04uc3RyaW5naWZ5KHRvZG9zKSB9O1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdzdG9yZSBmYWlsZWQhJywgZXJyb3IpO1xuICAgIH0pO1xuICB9O1xufTtcblxudmFyIFRvZG9MaXN0ID0gZnVuY3Rpb24oKSB7XG4gIHZhciBkYiA9IG5ldyBQb3VjaCgpO1xuICB2YXIgdG9kb3MgPSBtLnByb3AoZGIubG9hZCgpKTtcbiAgdG9kb3MudGhlbih0b2Rvcyk7XG5cbiAgdGhpcy5wdXNoID0gZnVuY3Rpb24odG9kbykge1xuICAgIHRvZG9zKCkucHVzaCh0b2RvKTtcbiAgICBkYi5zdG9yZSh0b2RvcygpKTtcbiAgfTtcblxuICB0aGlzLnNwbGljZSA9IGZ1bmN0aW9uKHRvZG8pIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBkb3Muc3BsaWNlKGRvcy5pbmRleE9mKHRvZG8pLCAxKTtcbiAgICBkYi5zdG9yZSh0b2RvcygpKTtcbiAgfTtcblxuICB0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uKHRvZG8pIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBkb3NbZG9zLmluZGV4T2YodG9kbyldID0gdG9kbztcbiAgICB0b2Rvcyhkb3MpO1xuICAgIGRiLnN0b3JlKHRvZG9zKTtcbiAgfTtcblxuICB0aGlzLm1hcCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICB2YXIgZG9zID0gdG9kb3MoKTtcbiAgICBpZiAoZG9zKVxuICAgICAgcmV0dXJuIGRvcy5tYXAoZnVuYyk7XG4gICAgZWxzZVxuICAgICAgdG9kb3MudGhlbihtLnJlZHJhdyk7XG4gIH07XG59O1xuXG50b2RvLnZtID0ge1xuICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICB0b2RvLnZtLmxpc3QgPSBuZXcgVG9kb0xpc3QoKTtcblxuICAgICAgICAgIHRvZG8udm0uZGVzY3JpcHRpb24gPSBtLnByb3AoJycpO1xuXG4gICAgICAgICAgZnVuY3Rpb24gYWRkVG9kbygpIHtcbiAgICAgICAgICAgIGlmICh0b2RvLnZtLmRlc2NyaXB0aW9uKCkpIHtcbiAgICAgICAgICAgICAgdG9kby52bS5saXN0LnB1c2gobmV3IFRvZG8oeyBkZXNjcmlwdGlvbjogdG9kby52bS5kZXNjcmlwdGlvbigpIH0pKTtcbiAgICAgICAgICAgICAgdG9kby52bS5kZXNjcmlwdGlvbignJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdG9kby52bS5rZXl1cCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHRvZG8udm0uZGVzY3JpcHRpb24oZS50YXJnZXQudmFsdWUpO1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYgKGUud2hpY2ggPT09IDEzKVxuICAgICAgICAgICAgICBhZGRUb2RvKCk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRvZG8udm0udG9nZ2xlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLmRvbmUoIXRoaXMuZG9uZSgpKTtcbiAgICAgICAgICAgIHRvZG8udm0ubGlzdC51cGRhdGUodGhpcyk7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHRvZG8udm0ucmVtb3ZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0b2RvLnZtLmxpc3Quc3BsaWNlKHRoaXMpO1xuICAgICAgICAgIH07XG4gICAgICAgIH1cbn07XG5cbnRvZG8uY29udHJvbGxlciA9IGZ1bmN0aW9uKCkge1xuICB0b2RvLnZtLmluaXQoKTtcbn07XG5cbnRvZG8udmlldyA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gPGRpdj5cbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdG9kby52bS5saXN0Lm1hcChmdW5jdGlvbih0YXNrLCBpbmRleCkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8ZGl2IGNsYXNzPVwidGFza1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz17IHRhc2suZG9uZSgpID8gXCJpY29uLWNhbmNlbC1kb25lXCIgOiBcImljb24tYW5nbGUtcmlnaHRcIsKgfT48L2k+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiYWxpZ24tdGV4dFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9eyB0YXNrLmRvbmUoKSA/IFwiY29sb3I6IGdyZXk7XCIgOiBcImNvbG9yOiBpbmhlcml0O1wiIH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB0YXNrLmRlc2NyaXB0aW9uKCkgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiaWNvbi1lbW8tdGh1bWJzdXBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2xpY2s9eyB0b2RvLnZtLnRvZ2dsZS5iaW5kKHRhc2spIH0+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvaT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9XCJpY29uLWNhbmNlbFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25jbGljaz17IHRvZG8udm0ucmVtb3ZlLmJpbmQodGFzaykgfT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9pPlxuICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwidGV4dFwiIGF1dG9mb2N1cyBwbGFjZWhvbGRlcj1cIldoYXQgZG8geW91IG5lZWQgZG9uZT9cIlxuICAgICAgICAgICAgICB2YWx1ZT17IHRvZG8udm0uZGVzY3JpcHRpb24oKSB9XG4gICAgICAgICAgICAgIG9ua2V5dXA9eyB0b2RvLnZtLmtleXVwIH1cbiAgICAgICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbn07XG5cbm0ubW91bnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RvZG9BcHAnKSwgdG9kbyk7Il19\n  </script>\n </head>\n <body>\n  <div class="header">\n   <h1>\n    Todos\n    <i class="icon-emo-thumbsup">\n    </i>\n   </h1>\n  </div>\n  <div id="todoApp">\n  </div>\n  <div class="footer">\n   <a href="https://github.com/orbitbot/mithril-pouch-todo">\n    find me on github\n   </a>\n  </div>\n  <script async="" src="http://www.google-analytics.com/ga.js" type="text/javascript">\n  </script>\n  <script src="libs/mithril.js">\n  </script>\n  <script src="libs/MSXTransformer.js">\n  </script>\n  <script src="libs/pouchdb.min.js">\n  </script>\n  <script src="libs/pouchdb.upsert.min.js">\n  </script>\n  <script src="mithril-pouch-todo.js" type="text/msx">\n  </script>\n  <!-- Google Analytics -->\n  <script>\n   var _gaq = _gaq || [];\n        _gaq.push([\'_setAccount\', \'UA-58175967-4\']);\n        _gaq.push([\'_trackPageview\']);\n        (function() {\n          var ga = document.createElement(\'script\'); ga.type = \'text/javascript\'; ga.async = true;\n          ga.src = (\'https:\' == document.location.protocol ? \'https://ssl\' : \'http://www\') + \'.google-analytics.com/ga.js\';\n          var s = document.getElementsByTagName(\'script\')[0]; s.parentNode.insertBefore(ga, s);\n        })();\n  </script>\n </body>\n</html>'